<script>
    const formCadastro = document.getElementById('form-Cadastro');
    formCadastro.addEventListener('submit', async (e) => {
        e.preventDefault();

        const dadosC = {
            nome: document.getElementById('nome').value,
            email: document.querySelector('#register-page #email').value,
            senha: document.querySelector('#register-page #senha').value
        };

        try {
            const resp = await fetch("/auth/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dadosC)
            });
 
            if (resp.ok) {
                alert("Cadastro realizado! Faça login.");
                togglePage();
                formCadastro.reset();
            } else {
                const txt = await resp.text();
                alert("Erro ao cadastrar: " + txt);
            }

        } catch (err) {
            alert("Erro de conexão: " + err.message);
        }
    });

    const formLogin = document.getElementById('form-login');
    formLogin.addEventListener('submit', async (e) => {
        e.preventDefault();

        const dadosL = {
            email: document.querySelector('#login-page #email').value,
            senha: document.querySelector('#login-page #senha').value
        };

        try {
            const resp = await fetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dadosL)
            });

            if (resp.ok) {
                const body = await resp.json();
                // se o backend retornar token: { token: "..." }
                if (body.token) {
                    localStorage.setItem("auth_token", body.token);
                }
                alert("Login realizado!");
                window.location.href = "/usuario"; // sua rota interna
            } else {
                const txt = await resp.text();
                alert("Erro ao logar: " + txt);
            }

        } catch (err) {
            alert("Erro de conexão: " + err.message);
        }
    });

    function togglePage() {
        document.getElementById("login-page").classList.toggle("hidden");
        document.getElementById("register-page").classList.toggle("hidden");
    }
</script>